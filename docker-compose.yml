services:
  claude-trilium-sync:
    image: ttlequals0/claude-trilium-sync:latest
    container_name: claude-trilium-sync
    restart: unless-stopped
    environment:
      # Required
      - TRILIUM_TOKEN=${TRILIUM_TOKEN}
      - CLAUDE_SESSION_KEY=${CLAUDE_SESSION_KEY}

      # Trilium server URL
      - TRILIUM_URL=${TRILIUM_URL:-http://trilium:8080}

      # Parent note configuration (optional)
      - PARENT_NOTE_ID=${PARENT_NOTE_ID:-}
      - PARENT_NOTE_TITLE=${PARENT_NOTE_TITLE:-Claude Chats}

      # Sync interval in seconds (0 = one-shot mode)
      - SYNC_INTERVAL=${SYNC_INTERVAL:-3600}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}

      # Pushover notifications (optional)
      - PUSHOVER_USER_KEY=${PUSHOVER_USER_KEY:-}
      - PUSHOVER_API_TOKEN=${PUSHOVER_API_TOKEN:-}
      - PUSHOVER_DEVICE=${PUSHOVER_DEVICE:-}

      # FlareSolverr for Cloudflare bypass
      - FLARESOLVERR_URL=${FLARESOLVERR_URL:-http://flaresolverr:8191/v1}
    volumes:
      - sync-state:/data
    networks:
      - trilium-net
    depends_on:
      - flaresolverr

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    restart: unless-stopped
    environment:
      - LOG_LEVEL=${FLARESOLVERR_LOG_LEVEL:-info}
      - LOG_HTML=${FLARESOLVERR_LOG_HTML:-false}
      - CAPTCHA_SOLVER=${FLARESOLVERR_CAPTCHA_SOLVER:-none}
      - TZ=${TZ:-UTC}
    networks:
      - trilium-net

volumes:
  sync-state:

networks:
  trilium-net:
    driver: bridge
